import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.awt.event.*;
import java.awt.geom.RoundRectangle2D;
import java.util.ArrayList;
import java.util.List;

public class ParkUI extends JFrame {

    // Renk Paleti (İstediğin Modern Renkler)
    private final Color COLOR_BG = new Color(30, 35, 45);
    private final Color COLOR_ROAD = new Color(55, 60, 70);
    private final Color COLOR_ROAD_LINE = new Color(240, 190, 50);

    // Park Durum Renkleri
    private final Color STATE_EMPTY = new Color(46, 213, 115);      // Canlı Yeşil
    private final Color STATE_RESERVED = new Color(255, 200, 50);   // Sarı
    private final Color STATE_OCCUPIED = new Color(255, 71, 87);    // Kırmızı
    private final Color STATE_SELECTED = new Color(55, 66, 250);    // Mavi (Seçili)

    private ParkingSlotButton currentSelectedSlot = null;
    private final List<ParkingSlotButton> allSlots = new ArrayList<>();

    // Login'den gelen kullanıcı adı
    private String loggedInPlaka;

    public ParkUI(String plaka) {
        this.loggedInPlaka = plaka;

        // --- Pencere Ayarları ---
        setTitle("39 PARK | Park Seçimi");
        setSize(1000, 700);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setLayout(new BorderLayout());
        getContentPane().setBackground(COLOR_BG);

        // 1. HEADER (Başlık)
        JPanel headerPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 30, 20));
        headerPanel.setOpaque(false);

        JLabel titleLabel = new JLabel("39 PARK");
        titleLabel.setFont(new Font("Segoe UI", Font.BOLD, 32));
        titleLabel.setForeground(Color.WHITE);

        JLabel subTitle = new JLabel(" |  Hoş geldin, " + loggedInPlaka);
        subTitle.setFont(new Font("Segoe UI", Font.PLAIN, 18));
        subTitle.setForeground(new Color(150, 150, 160));

        headerPanel.add(titleLabel);
        headerPanel.add(subTitle);
        add(headerPanel, BorderLayout.NORTH);

        // 2. ORTA ALAN (Yol ve Park Yerleri)
        JPanel mainContent = new JPanel(new GridBagLayout());
        mainContent.setOpaque(false);
        mainContent.setBorder(new EmptyBorder(20, 20, 20, 20));

        GridBagConstraints gbc = new GridBagConstraints();
        gbc.fill = GridBagConstraints.BOTH;
        gbc.insets = new Insets(10, 10, 10, 10);

        // Sol Park Bloğu
        JPanel leftBlock = createParkingBlock(1, 4);
        gbc.gridx = 0; gbc.weightx = 0.4;
        mainContent.add(leftBlock, gbc);

        // Orta Yol Şeridi (Custom Painting)
        JPanel roadPanel = createRoadPanel();
        gbc.gridx = 1; gbc.weightx = 0.2;
        mainContent.add(roadPanel, gbc);

        // Sağ Park Bloğu
        JPanel rightBlock = createParkingBlock(5, 8);
        gbc.gridx = 2; gbc.weightx = 0.4;
        mainContent.add(rightBlock, gbc);

        add(mainContent, BorderLayout.CENTER);

        // 3. ALT KONTROL PANELİ
        add(createControlPanel(), BorderLayout.SOUTH);
    }

    private JPanel createParkingBlock(int startId, int endId) {
        JPanel panel = new JPanel(new GridLayout(0, 1, 15, 15));
        panel.setOpaque(false);
        for (int i = startId; i <= endId; i++) {
            ParkingSlotButton slot = new ParkingSlotButton("P-" + i);
            allSlots.add(slot);
            slot.addActionListener(e -> handleSlotSelection(slot));
            panel.add(slot);
        }
        return panel;
    }

    private JPanel createRoadPanel() {
        return new JPanel() {
            @Override
            protected void paintComponent(Graphics g) {
                super.paintComponent(g);
                Graphics2D g2 = (Graphics2D) g;
                g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

                // Asfalt
                g2.setColor(COLOR_ROAD);
                g2.fillRect(0, 0, getWidth(), getHeight());

                // Şerit Çizgileri
                g2.setColor(COLOR_ROAD_LINE);
                Stroke dashed = new BasicStroke(4, BasicStroke.CAP_BUTT, BasicStroke.JOIN_BEVEL, 0, new float[]{20, 30}, 0);
                g2.setStroke(dashed);
                g2.drawLine(getWidth() / 2, 0, getWidth() / 2, getHeight());

                // Yol Kenar Çizgileri
                g2.setStroke(new BasicStroke(2));
                g2.setColor(Color.LIGHT_GRAY);
                g2.drawLine(5, 0, 5, getHeight());
                g2.drawLine(getWidth()-5, 0, getWidth()-5, getHeight());
            }
        };
    }

    private JPanel createControlPanel() {
        JPanel panel = new JPanel(new FlowLayout(FlowLayout.CENTER, 25, 25));
        panel.setBackground(new Color(40, 45, 55));
        panel.setPreferredSize(new Dimension(0, 100));

        // Saat Seçimi
        JLabel lblTime = new JLabel("Süre Seç:");
        lblTime.setForeground(Color.WHITE);
        lblTime.setFont(new Font("Segoe UI", Font.PLAIN, 14));

        JComboBox<String> cmbTime = new JComboBox<>(new String[]{"1 Saat", "2 Saat", "4 Saat","6 Saat" , "8 Saat" , "12 Saat",  "Tüm Gün"});
        cmbTime.setPreferredSize(new Dimension(100, 35));

        // Butonlar
        ModernActionButton btnReserve = new ModernActionButton("Rezerve Et", STATE_RESERVED);
        btnReserve.addActionListener(e -> processAction(SlotStatus.RESERVED));

        ModernActionButton btnOccupy = new ModernActionButton("Yeri Ayır", STATE_OCCUPIED);
        btnOccupy.addActionListener(e -> processAction(SlotStatus.OCCUPIED));

        // Boşalt Butonu
        JButton btnClear = new JButton("Seçimi Geri Al");
        btnClear.setPreferredSize(new Dimension(100, 45));
        btnClear.setBackground(Color.WHITE);
        btnClear.setForeground(Color.BLUE);
        btnClear.setFocusPainted(false);
        btnClear.addActionListener(e -> processAction(SlotStatus.EMPTY));

        panel.add(lblTime);
        panel.add(cmbTime);
        panel.add(btnReserve);
        panel.add(btnOccupy);
        panel.add(btnClear);

        return panel;
    }

    private void handleSlotSelection(ParkingSlotButton clickedSlot) {
        if (currentSelectedSlot == clickedSlot) {
            clickedSlot.setSelected(false);
            currentSelectedSlot = null;
        } else {
            if (currentSelectedSlot != null) {
                currentSelectedSlot.setSelected(false);
            }
            currentSelectedSlot = clickedSlot;
            currentSelectedSlot.setSelected(true);
        }
    }

    private void processAction(SlotStatus newStatus) {
        if (currentSelectedSlot != null) {
            currentSelectedSlot.setStatus(newStatus);
            currentSelectedSlot.setSelected(false);
            currentSelectedSlot = null;
            // Buraya SQL Update kodu eklenebilir
        } else {
            JOptionPane.showMessageDialog(this, "Lütfen işlem yapmak için bir park yeri seçin.");
        }
    }

    // ==========================================
    // INNER CLASSES (ÖZEL TASARIMLI BUTONLAR)
    // ==========================================

    private enum SlotStatus { EMPTY, RESERVED, OCCUPIED }

    // Yuvarlak ve Duruma Göre Renk Değiştiren Park Yeri Butonu
    private class ParkingSlotButton extends JButton {
        private SlotStatus status = SlotStatus.EMPTY;
        private boolean isSelected = false;
        private final String label;

        public ParkingSlotButton(String text) {
            this.label = text;
            setContentAreaFilled(false);
            setFocusPainted(false);
            setBorderPainted(false);
            setCursor(new Cursor(Cursor.HAND_CURSOR));
            setPreferredSize(new Dimension(140, 70));
        }

        public void setStatus(SlotStatus s) { this.status = s; repaint(); }
        public void setSelected(boolean sel) { this.isSelected = sel; repaint(); }

        @Override
        protected void paintComponent(Graphics g) {
            Graphics2D g2 = (Graphics2D) g;
            g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

            Color fillColor;
            if (isSelected) fillColor = STATE_SELECTED;
            else if (status == SlotStatus.RESERVED) fillColor = STATE_RESERVED;
            else if (status == SlotStatus.OCCUPIED) fillColor = STATE_OCCUPIED;
            else fillColor = STATE_EMPTY;

            // Yuvarlak Buton Çizimi
            g2.setColor(fillColor);
            g2.fill(new RoundRectangle2D.Float(5, 5, getWidth()-10, getHeight()-10, 20, 20));

            // Kenar Çizgisi
            g2.setColor(new Color(255, 255, 255, 50));
            g2.setStroke(new BasicStroke(2));
            g2.draw(new RoundRectangle2D.Float(5, 5, getWidth()-10, getHeight()-10, 20, 20));

            // Yazı
            g2.setColor(Color.WHITE);
            g2.setFont(new Font("Segoe UI", Font.BOLD, 18));
            FontMetrics fm = g2.getFontMetrics();
            int x = (getWidth() - fm.stringWidth(label)) / 2;
            int y = (getHeight() + fm.getAscent()) / 2 - 5;
            g2.drawString(label, x, y);

            // Alt Durum Yazısı
            String statusText = isSelected ? "SEÇİLDİ" : status.toString();
            g2.setFont(new Font("Segoe UI", Font.PLAIN, 10));
            g2.setColor(new Color(255,255,255, 200));
            int subX = (getWidth() - g2.getFontMetrics().stringWidth(statusText)) / 2;
            g2.drawString(statusText, subX, y + 15);
        }
    }

    // Alt Paneldeki Modern Aksiyon Butonları
    private class ModernActionButton extends JButton {
        private final Color baseColor;

        public ModernActionButton(String text, Color color) {
            super(text);
            this.baseColor = color;
            setContentAreaFilled(false);
            setFocusPainted(false);
            setBorderPainted(false);
            setForeground(Color.WHITE);
            setFont(new Font("Segoe UI", Font.BOLD, 14));
            setCursor(new Cursor(Cursor.HAND_CURSOR));
            setPreferredSize(new Dimension(130, 45));

            addMouseListener(new MouseAdapter() {
                public void mouseEntered(MouseEvent e) { setForeground(Color.WHITE); }
                public void mouseExited(MouseEvent e) { setForeground(Color.WHITE); }
            });
        }

        @Override
        protected void paintComponent(Graphics g) {
            Graphics2D g2 = (Graphics2D) g;
            g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

            if (getModel().isPressed()) g2.setColor(baseColor.darker());
            else if (getModel().isRollover()) g2.setColor(baseColor.brighter());
            else g2.setColor(baseColor);

            g2.fill(new RoundRectangle2D.Float(0, 0, getWidth(), getHeight(), 15, 15));

            g2.setColor(getForeground());
            FontMetrics fm = g2.getFontMetrics();
            int x = (getWidth() - fm.stringWidth(getText())) / 2;
            int y = (getHeight() + fm.getAscent()) / 2 - 2;
            g2.drawString(getText(), x, y);
        }
    }
}
